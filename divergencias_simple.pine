//@version=6
indicator("Divergencias Simple RSI/MACD", overlay=true)

// === INPUTS ===
rsiLen = input.int(14, title="RSI Length", minval=1)
macdFastLen = input.int(12, title="MACD Fast Length", minval=1)
macdSlowLen = input.int(26, title="MACD Slow Length", minval=1)
macdSignalLen = input.int(9, title="MACD Signal Length", minval=1)
obzLen = input.int(20, title="Zona OB/OS Length", minval=1)

// === CÁLCULOS BÁSICOS ===
rsiVal = ta.rsi(close, rsiLen)
[macdLine, signalLine, histLine] = ta.macd(close, macdFastLen, macdSlowLen, macdSignalLen)

// === ZONAS OB/OS ===
highLevel = ta.highest(high, obzLen)
lowLevel = ta.lowest(low, obzLen)
isOverbought = close >= highLevel * 0.995
isOversold = close <= lowLevel * 1.005

// === SEÑALES SIMPLES ===
// Compra: RSI cruza sobre 30 desde abajo o MACD cruza sobre la señal
buySignal = (ta.crossover(rsiVal, 30) or ta.crossover(macdLine, signalLine)) and isOversold

// Venta: RSI cruza bajo 70 desde arriba o MACD cruza bajo la señal
sellSignal = (ta.crossunder(rsiVal, 70) or ta.crossunder(macdLine, signalLine)) and isOverbought

// === VISUALIZACIÓN ===
plotshape(buySignal, title="Señal de Compra", location=location.belowbar, 
     color=color.green, style=shape.labelup, size=size.normal, text="BUY")
plotshape(sellSignal, title="Señal de Venta", location=location.abovebar, 
     color=color.red, style=shape.labeldown, size=size.normal, text="SELL")

// Indicadores de zonas
bgcolor(isOverbought ? color.new(color.red, 95) : na)
bgcolor(isOversold ? color.new(color.green, 95) : na)

// === ALERTAS ===
alertcondition(buySignal, title="Alerta de Compra", message="¡Señal de compra detectada!")
alertcondition(sellSignal, title="Alerta de Venta", message="¡Señal de venta detectada!")
